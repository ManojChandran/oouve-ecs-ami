{
  "variables" : {
    "vpc": "{{env `BUILD_VPC_ID`}}",
    "subnet": "{{env `BUILD_SUBNET_ID`}}",
    "aws_region": "{{env `AWS_REGION`}}",
    "ami_name": "oouve-prod-amzn-{{isotime \"02-Jan-06 03_04_05\"}}"
  },

  "builders" : [{
    "name"      : "AWS AMI Builder - oouve",
    "vpc_id"    : "{{user `vpc`}}",
    "region"    : "{{user `aws_region`}}",
    "subnet_id" : "{{user `subnet`}}",
    "ami_name"  : "{{user `ami_name`}}",
    "type"      : "amazon-ebs",
    "ssh_username": "ec2-user",
    "instance_type": "t2.micro",
    "source_ami_filter": {
      "filters" : {
        "virtualization-type": "hvm",
        "name"  : "amzn-ami-hvm-2019.*-gp2",
        "root-device-type"   : "ebs"
      },
      "owners" : ["883208102877"],
      "most_recent": true
    },
    "associate_public_ip_address": "true",
    "tags": {
      "Name": "{{user `ami_name`}}"
    }
  }],

  "provisioners" : [
    {
      "type"  : "shell",
      "script": "base-init.sh"
    }
  ],

  "post-processors" : [
    {
      "type"      : "manifest",
      "output"    : "manifest.json",
      "strip_path": true
    }
  ]

}
